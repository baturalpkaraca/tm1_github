SKIPCHECK;

[ 'Fiili', 'NET SALES' ] = N: DB( 'PL Fiili', 'TOTAL NET SALES', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount' );

[ 'Fiili', 'OPCO' ] = N: DB( 'PL Fiili', 'Operations contribution', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount' );

[ 'Fiili', 'EBITDA' ] = N: 
  DB('PL Fiili', 'Operations contribution', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount') - 
  DB('PL Fiili', '- retail asset depreciation', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount') - 
  DB('PL Fiili', '- credit card charges', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount');

[ 'Fiili', 'EBITDA BÜTÇE' ] = N: 
  DB('PL', 'Operations contribution', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Bütçe', 'Değer' ), !Period, 'Amount') - 
  DB('PL', '- retail asset depreciation', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Bütçe', 'Değer' ), !Period, 'Amount') - 
  DB('PL', '- credit card charges', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Bütçe', 'Değer' ), !Period, 'Amount');

[ 'Fiili', 'EBITDA Forecast' ] = N: 
  DB('PL', 'Operations contribution', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Forecast', 'Değer' ), !Period, 'Amount') - 
  DB('PL', '- retail asset depreciation', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Forecast', 'Değer' ), !Period, 'Amount') - 
  DB('PL', '- credit card charges', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Forecast', 'Değer' ), !Period, 'Amount');

[ 'Fiili', 'EBITDA DIFF' ] = N: [ 'EBITDA' ] - [ 'EBITDA BÜTÇE' ];

[ 'Fiili', 'EBITDA DIFF Forecast' ] = N: [ 'EBITDA' ] - [ 'EBITDA Forecast' ];

[ 'Fiili', 'PBT' ] = N: DB('PL Fiili', 'PROFIT BEFORE TAXATION', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount');

[ 'Fiili', '- rent' ] = N: DB('PL Fiili', '- rent', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount');

[ 'Fiili', 'rent bütçe' ] = N: DB( 'PL', '- rent', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Bütçe', 'Değer' ), !Period, 'Amount' );

[ 'Fiili', 'rent Forecast' ] = N: DB( 'PL', '- rent', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Forecast', 'Değer' ), !Period, 'Amount' );

[ 'Fiili', 'rent diff' ] = N: [ '- rent' ] - [ 'rent bütçe' ];

[ 'Fiili', 'rent diff Forecast' ] = N: [ '- rent' ] - [ 'rent Forecast' ];

[ 'Fiili', 'total staff' ] = N: 
  DB('PL Fiili', '- staff (Payroll)', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount') + 
  DB('PL Fiili', '- staff (exc. Payroll)', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount') + 
  DB('PL Fiili', '- term. benefit provision', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount') + 
  DB('PL Fiili', '- bonus', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Amount');

[ 'Fiili', 'total staff bütçe' ] = N: 
  DB('PL', '- staff (Payroll)', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Bütçe', 'Değer' ), !Period, 'Amount') + 
  DB('PL', '- staff (exc. Payroll)', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Bütçe', 'Değer' ), !Period, 'Amount') + 
  DB('PL', '- term. benefit provision', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Bütçe', 'Değer' ), !Period, 'Amount') + 
  DB('PL', '- bonus', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Bütçe', 'Değer' ), !Period, 'Amount');

[ 'Fiili', 'total staff Forecast' ] = N: 
  DB('PL', '- staff (Payroll)', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Forecast', 'Değer' ), !Period, 'Amount') + 
  DB('PL', '- staff (exc. Payroll)', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Forecast', 'Değer' ), !Period, 'Amount') + 
  DB('PL', '- term. benefit provision', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Forecast', 'Değer' ), !Period, 'Amount') + 
  DB('PL', '- bonus', 'Total Source', !Masraf_Kar_Merkezleri, DB( 'Sistem', 'Ana Senaryo - Forecast', 'Değer' ), !Period, 'Amount');

[ 'Fiili', 'total staff diff' ] = N: [ 'total staff' ] - [ 'total staff bütçe' ];

[ 'Fiili', 'total staff diff Forecast' ] = N: [ 'total staff' ] - [ 'total staff Forecast' ];

[ 'Fiili', 'EBITDAR' ] = N: [ 'EBITDA' ] - [ '- rent' ];

[ 'Fiili', 'KM' ] =  S: 
	DB('}ElementAttributes_Masraf_Kar_Merkezleri', !Masraf_Kar_Merkezleri, 'Kar Merkezi Code' );

[ 'Fiili', 'Format' ] =  S: 
	DB( 'MM_V_P Fiili', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Mağaza Türü' );

[ 'Fiili', 'OPENNING DATE' ] =  S: 
	DB( 'MM_V_P Fiili', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Açılış Tarihi' );

# [ 'Fiili', 'SQM' ] =  C: IF( SUBST( !Period, 9, 3 ) @= 'YTD', DB( 'MM_V_P Fiili', !Masraf_Kar_Merkezleri, !Version_Actual, SUBST( !Period, 1, 4 ), 'Metrekare' ), CONTINUE );

[ 'Fiili', 'SQM' ] =  N: DB( 'MM_V_P Fiili', !Masraf_Kar_Merkezleri, !Version_Actual, !Period, 'Metrekare' );

[ 'Fiili', 'total sales per sqm' ] = [ 'NET SALES' ] \ [ 'SQM' ];

[ 'Fiili', 'Staff Cost/Sqm' ] = [ 'total staff' ] \ [ 'SQM' ];

[ 'Fiili', 'OPCO %' ] = [ 'OPCO' ] \ [ 'NET SALES' ];

[ 'Fiili', 'EBITDA %' ] = [ 'EBITDA' ] \ [ 'NET SALES' ];

[ 'Fiili', 'PBT %' ] = [ 'PBT' ] \ [ 'NET SALES' ];

[ 'Fiili', '- rent %' ] = [ '- rent' ] \ [ 'NET SALES' ];

[ 'Fiili', 'Staf Cost/Sales' ] = [ 'total staff' ] \ [ 'NET SALES' ];

[ 'Fiili', 'WCAP COST' ] =  N: 
	(DB('PL Fiili', 'External interest received', 'Koçtaş Total', !Version_Actual, !Period, 'Amount') + 
     DB('PL Fiili', 'Short&Long term interest paid', 'Koçtaş Total', !Version_Actual, !Period, 'Amount') + 
     DB('PL Fiili', 'Given Exchange Rate Difference', 'Koçtaş Total', !Version_Actual, !Period, 'Amount') + 
     DB('PL Fiili', 'Interest element of finance leases', 'Koçtaş Total', !Version_Actual, !Period, 'Amount') + 
     DB('PL Fiili', 'Other Financial Expense', 'Koçtaş Total', !Version_Actual, !Period, 'Amount')) * [ 'STOK' ] \ [ 'Koçtaş Total', 'STOK' ];

[ 'Fiili', 'EBITDA+WCAP COST' ] = [ 'WCAP COST' ] + [ 'EBITDA' ];

[ 'Fiili', 'EBITDA+WCAP COST %' ] = [ 'EBITDA+WCAP COST' ] \ [ 'NET SALES' ];

FEEDERS;

['Fiili', {'EBITDA', 'EBITDA BÜTÇE'}] => ['EBITDA DIFF'];
['Fiili', {'EBITDA', 'EBITDA Forecast'}] => ['EBITDA DIFF Forecast'];
['Fiili', {'- rent', 'rent bütçe'}] => ['rent diff'];
['Fiili', {'- rent', 'rent Forecast'}] => ['rent diff Forecast'];

['Fiili', {'total staff', 'total staff bütçe'}] => ['total staff diff'];
['Fiili', {'total staff', 'total staff Forecast'}] => ['total staff diff Forecast'];
['Fiili', {'EBITDA', '- rent'}] => ['EBITDAR'];
#['Fiili', 'NET SALES'] => ['total sales per sqm'], ['Staff Cost/Sqm'], ['OPCO %'], ['EBITDA %'], ['PBT %'], ['- rent %'], ['Staf Cost/Sales'], ['EBITDA+WCAP COST'], ['EBITDA+WCAP COST %'];
